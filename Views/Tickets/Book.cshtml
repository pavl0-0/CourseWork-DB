@model Kino.ViewModels.BookingViewModel
@{
    ViewData["Title"] = "Вибір місць";
}

<style>
    .screen {
        background: #555;
        height: 5px;
        width: 60%;
        margin: 0 auto 40px auto;
        border-radius: 50%;
        box-shadow: 0 0 20px rgba(255,255,255,0.2);
    }

    .hall-grid {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        margin-bottom: 20px;
    }

    .hall-row {
        display: flex;
        gap: 6px;
        justify-content: center;
    }

    .seat {
        width: 32px;
        height: 32px;
        background-color: #2b2b2b;
        border: 1px solid #444;
        border-radius: 6px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #aaa;
        font-size: 0.7rem;
        font-weight: 500;
        transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
    }

    .seat:hover:not(.booked) {
        transform: scale(1.15);
        z-index: 2;
        border-color: #fff;
        color: #fff;
        box-shadow: 0 0 10px rgba(255,255,255,0.2);
    }

    .seat.vip {
        border: 1px solid #d4af37;
        color: #d4af37;
    }

    .seat.vip:hover:not(.booked) {
        background-color: #d4af37;
        color: #000;
        box-shadow: 0 0 15px rgba(212, 175, 55, 0.6);
    }

    .seat.booked {
        background-color: #1a1a1a;
        border-color: #222;
        color: #333;
        cursor: not-allowed;
        background-image: linear-gradient(45deg, #1a1a1a 25%, #222 25%, #222 50%, #1a1a1a 50%, #1a1a1a 75%, #222 75%, #222 100%);
        background-size: 10px 10px;
    }

    .seat.selected {
        background-color: #e50914 !important;
        border-color: #ff0a1b !important;
        color: white !important;
        transform: scale(1.1);
        box-shadow: 0 0 15px rgba(229, 9, 20, 0.5);
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.85rem;
        color: #ccc;
    }

    .legend-box {
        width: 20px;
        height: 20px;
        border-radius: 4px;
        border: 1px solid transparent;
    }
</style>

<div class="container" style="padding-bottom: 100px;">
    <div class="text-center mb-4">
        <h2 style="color: var(--accent-color);">@Model.MovieTitle</h2>
        <p class="text-muted">@Model.HallName | @Model.StartTime.ToString("HH:mm")</p>
    </div>

    <div class="screen"></div>

    <div class="hall-grid">
        @foreach (var row in Model.Rows)
        {
            <div class="hall-row">
                <span style="color: #555; font-size: 0.7rem; width: 15px; padding-top: 8px;">@row.RowNumber</span>
                @foreach (var seat in row.Seats)
                {
                    <div class="seat @(seat.IsBooked ? "booked" : "") @( (seat.Type.ToLower().Contains("vip") || seat.Type.ToLower().Contains("lux")) ? "vip" : "" )"
                         data-id="@seat.SeatId"
                         data-price="@(Model.BasePrice* seat.PriceMultiplier)"
                         onclick="toggleSeat(this)">
                        @seat.Number
                    </div>
                }
            </div>
        }
    </div>

    <div class="d-flex justify-content-center gap-4 mt-4 mb-4 p-3" style="background: #1e1e1e; border-radius: 8px; border: 1px solid #333; display: inline-flex;">

        <div class="legend-item">
            <div class="legend-box" style="background: #2b2b2b; border: 1px solid #444;"></div>
            <span>Standard</span>
        </div>

        <div class="legend-item">
            <div class="legend-box" style="background: #2b2b2b; border: 1px solid #d4af37;"></div>
            <span style="color: #d4af37;">VIP / Lux</span>
        </div>

        <div class="legend-item">
            <div class="legend-box" style="background: #1a1a1a; border: 1px solid #333; opacity: 0.7;"></div>
            <span>Зайнято</span>
        </div>

        <div class="legend-item">
            <div class="legend-box" style="background: #e50914;"></div>
            <span style="color: white;">Ваш вибір</span>
        </div>

    </div>
</div>

<form asp-action="Checkout" method="post">
    <input type="hidden" name="sessionId" value="@Model.SessionId" />
    <input type="hidden" name="selectedSeatIds" id="selectedSeatIds" />

    <div class="summary-bar">
        <div class="container d-flex justify-content-between">
            <div>
                <h4 style="margin: 0;">Сума: <span id="totalPrice" style="color: var(--accent-color);">0</span> грн</h4>
                <small class="text-muted">Місць: <span id="seatCount">0</span></small>
            </div>
            <button type="submit" class="btn-cinema" id="buyBtn" disabled>Продовжити ➝</button>
        </div>
    </div>
</form>

<script>
    let total = 0; let selectedIds = [];
    function toggleSeat(el) {
        if (el.classList.contains('booked')) return;
        let price = parseFloat(el.getAttribute('data-price'));
        let id = el.getAttribute('data-id');
        if (el.classList.contains('selected')) {
            el.classList.remove('selected'); total -= price; selectedIds = selectedIds.filter(x => x !== id);
        } else {
            el.classList.add('selected'); total += price; selectedIds.push(id);
        }
        document.getElementById('totalPrice').innerText = total.toFixed(0);
        document.getElementById('seatCount').innerText = selectedIds.length;
        document.getElementById('selectedSeatIds').value = selectedIds.join(',');
        document.getElementById('buyBtn').disabled = selectedIds.length === 0;
    }
</script>